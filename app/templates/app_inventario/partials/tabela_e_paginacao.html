{% comment %} 
    Conteúdo unificado para ser o target do HTMX: Tabela + Paginação.
{% endcomment %}

<div id="tabela-patrimonios">
  <table class="table table-hover align-middle">
    <thead class="table-success">
      <tr>
        <th>Nº Patrimônio</th>
        <th>Descrição</th>
        <th>Setor</th>
        <th>Usuário Responsável</th>
        <th>Situação</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for p in lista_patrimonios %}
      <tr>
        <td>{{ p.patrimonio }}</td>
        <td>{{ p.descricao|truncatechars:50 }}</td>
        <td>{{ p.setor }}</td>

        <td>{{ p.inventariante.user.get_full_name | default:p.inventariante.user.username }}</td> 
        
        <td>{{ p.get_situacao_display }}</td>

        <td>
          <div class="d-flex flex-md-row flex-column gap-2">
            <button
              class="btn btn-sm btn-outline-primary w-100"
              hx-get="{% url 'patrimonio_edit' p.pk %}"
              hx-target="#modal-patrimonio-body"
              hx-swap="innerHTML"
              data-bs-toggle="modal"
              data-bs-target="#modalPatrimonio"
            >
              Editar
            </button>

            <button
              class="btn btn-sm btn-outline-danger w-100"
              hx-get="{% url 'confirmar_exclusao_patrimonio' p.pk %}"
              hx-target="#conteudo-admin" 
              hx-swap="outerHTML"
            >
              Excluir
            </button>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center text-muted">
          Nenhum patrimônio encontrado.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">

    {% with q_param=search_query|urlencode %} 
      
      {% if lista_patrimonios.has_previous %}
        <li class="page-item">
          <a 
            class="page-link" 
            href="#" 
            hx-get="{% url 'patrimonio_list' %}?page=1{% if q_param %}&q={{ q_param }}{% endif %}"
            hx-target="#conteudo-admin"  
            hx-swap="innerHTML"
          >&laquo; Primeira</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">&laquo; Primeira</span>
        </li>
      {% endif %}

      {% if lista_patrimonios.has_previous %}
        <li class="page-item">
          <a 
            class="page-link" 
            href="#" 
            hx-get="{% url 'patrimonio_list' %}?page={{ lista_patrimonios.previous_page_number }}{% if q_param %}&q={{ q_param }}{% endif %}"
            hx-target="#conteudo-admin" 
            hx-swap="innerHTML"
          >Anterior</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">Anterior</span>
        </li>
      {% endif %}

      <li class="page-item active">
        <span class="page-link">
          {{ lista_patrimonios.number }} / {{ lista_patrimonios.paginator.num_pages }}
        </span>
      </li>

      {% if lista_patrimonios.has_next %}
        <li class="page-item">
          <a 
            class="page-link" 
            href="#" 
            hx-get="{% url 'patrimonio_list' %}?page={{ lista_patrimonios.next_page_number }}{% if q_param %}&q={{ q_param }}{% endif %}"
            hx-target="#conteudo-admin"  
            hx-swap="innerHTML"
          >Próxima</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">Próxima</span>
        </li>
      {% endif %}

      {% if lista_patrimonios.has_next %}
        <li class="page-item">
          <a 
            class="page-link" 
            href="#" 
            hx-get="{% url 'patrimonio_list' %}?page={{ lista_patrimonios.paginator.num_pages }}{% if q_param %}&q={{ q_param }}{% endif %}"
            hx-target="#conteudo-admin" 
            hx-swap="innerHTML"
          >Última &raquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">Última &raquo;</span>
        </li>
      {% endif %}

    {% endwith %}

  </ul>
</nav>