<div id="tabela-patrimonios">
  <div class="table-responsive">

    <table class="table table-hover align-middle mb-0" style="min-width: 800px;">
      <thead class="table-success">
        <tr>
          <th class="text-nowrap">Nº Patrimônio</th>
          <th>Descrição</th>
          <th class="text-nowrap d-none d-md-table-cell">Setor</th>
          <th class="text-nowrap">Usuário Responsável</th>
          <th class="text-nowrap">Situação</th>
          <th class="text-nowrap">Ações</th>
        </tr>
      </thead>

      <tbody>
        {% for p in lista_patrimonios %}
        <tr>
          <!-- Nº Patrimônio -->
          <td>{{ p.patrimonio }}</td>

          <!-- Descrição -->
          <td>{{ p.descricao|truncatechars:50 }}</td>

          <!-- Setor (visível a partir de md) -->
          <td class="d-none d-md-table-cell">{{ p.setor }}</td>

          <!-- Usuário Responsável (sempre visível) -->
          <td>
            {% if p.inventariante %}
              {% if p.inventariante.user.is_superuser %}
                {{ p.inventariante.user.get_full_name|default:p.inventariante.user.username }} (Superusuário)
              {% else %}
                {{ p.inventariante.user.get_full_name|default:p.inventariante.user.username }}
              {% endif %}
            {% else %}
              <!-- Sem responsável: espaço vazio -->
            {% endif %}
          </td>

          <!-- Situação -->
          <td>
            {% include "app_inventario/partials/situacao_select.html" with p=p %}
          </td>

          <!-- Ações -->
          <td>
            <div class="d-flex flex-md-row flex-column gap-2">
              <button class="btn btn-sm btn-outline-primary w-100"
                      hx-get="{% url 'patrimonio_edit' p.pk %}"
                      hx-target="#modal-patrimonio-body"
                      hx-swap="innerHTML"
                      data-bs-toggle="modal"
                      data-bs-target="#modalPatrimonio">
                Editar
              </button>

              <button class="btn btn-sm btn-outline-danger w-100"
                      hx-get="{% url 'confirmar_exclusao_patrimonio' p.pk %}"
                      hx-target="#modal-confirm-body"
                      hx-swap="innerHTML"
                      data-bs-toggle="modal"
                      data-bs-target="#modalConfirm">
                Excluir
              </button>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center text-muted">
            Nenhum patrimônio encontrado.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

  <!-- Paginação -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center flex-wrap">
      {% with q_param=search_query|urlencode %}

      <!-- Primeira página -->
      {% if lista_patrimonios.has_previous %}
      <li class="page-item">
        <a class="page-link"
           hx-get="{% url 'patrimonio_list' %}?page=1{% if q_param %}&q={{ q_param }}{% endif %}"
           hx-target="#conteudo-admin"
           hx-swap="innerHTML">&laquo; Primeira</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">&laquo; Primeira</span></li>
      {% endif %}

      <!-- Página anterior -->
      {% if lista_patrimonios.has_previous %}
      <li class="page-item">
        <a class="page-link"
           hx-get="{% url 'patrimonio_list' %}?page={{ lista_patrimonios.previous_page_number }}{% if q_param %}&q={{ q_param }}{% endif %}"
           hx-target="#conteudo-admin"
           hx-swap="innerHTML">Anterior</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Anterior</span></li>
      {% endif %}

      <!-- Intervalo de páginas -->
      {% for num in lista_patrimonios.paginator.page_range %}
        {% if num >= lista_patrimonios.number|add:-2 and num <= lista_patrimonios.number|add:2 %}
        <li class="page-item {% if num == lista_patrimonios.number %}active{% endif %}">
          {% if num == lista_patrimonios.number %}
          <span class="page-link">{{ num }}</span>
          {% else %}
          <a class="page-link"
             hx-get="{% url 'patrimonio_list' %}?page={{ num }}{% if q_param %}&q={{ q_param }}{% endif %}"
             hx-target="#conteudo-admin"
             hx-swap="innerHTML">{{ num }}</a>
          {% endif %}
        </li>
        {% endif %}
      {% endfor %}

      <!-- Próxima página -->
      {% if lista_patrimonios.has_next %}
      <li class="page-item">
        <a class="page-link"
           hx-get="{% url 'patrimonio_list' %}?page={{ lista_patrimonios.next_page_number }}{% if q_param %}&q={{ q_param }}{% endif %}"
           hx-target="#conteudo-admin"
           hx-swap="innerHTML">Próxima</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Próxima</span></li>
      {% endif %}

      <!-- Última página -->
      {% if lista_patrimonios.has_next %}
      <li class="page-item">
        <a class="page-link"
           hx-get="{% url 'patrimonio_list' %}?page={{ lista_patrimonios.paginator.num_pages }}{% if q_param %}&q={{ q_param }}{% endif %}"
           hx-target="#conteudo-admin"
           hx-swap="innerHTML">Última &raquo;</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Última &raquo;</span></li>
      {% endif %}

      {% endwith %}
    </ul>
  </nav>

</div>
