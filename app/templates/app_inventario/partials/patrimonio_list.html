{% load static %}

{% block content %}
<div class="mb-3">
  <h5 class="fw-bold text-success">Lista de Patrimônios</h5>
  <button class="btn btn-success btn-sm mt-2" hx-get="{% url 'patrimonio_form' %}" hx-target="#modal-patrimonio-body"
    hx-trigger="click" hx-swap="innerHTML" data-bs-toggle="modal" data-bs-target="#modalPatrimonio">
    Adicionar Patrimônio
  </button>
</div>

<!-- Modal Bootstrap -->
<div class="modal fade" id="modalPatrimonio" tabindex="-1" aria-labelledby="modalPatrimonioLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">
      <div class="modal-header">
        <h5 class="modal-title text-success fw-semibold" id="modalPatrimonioLabel">Novo Patrimônio</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body" id="modal-patrimonio-body">
        <!-- O formulário será carregado aqui via HTMX -->
      </div>
    </div>
  </div>
</div>

<!-- Contêiner da tabela -->
<div id="tabela-patrimonios">
  {% include 'app_inventario/partials/tabela_patrimonios.html' %}
</div>

<script>
  // Fecha o modal automaticamente quando a tabela de patrimônios for atualizada
  document.body.addEventListener("htmx:afterSwap", (event) => {
    if (event.target.id === "tabela-patrimonios") {
      const modalEl = document.getElementById("modalPatrimonio");
      const modal = bootstrap.Modal.getInstance(modalEl);
      if (modal) modal.hide();
    }
  });

  // Limpa o conteúdo do modal ao fechar
  document.getElementById("modalPatrimonio").addEventListener("hidden.bs.modal", () => {
    document.getElementById("modal-patrimonio-body").innerHTML = "";
  });
</script>

{% endblock %}